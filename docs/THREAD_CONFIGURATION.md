# Настройка потоков в Network Scanner

## Обзор

Система использует несколько уровней потоков для оптимальной производительности:

1. **Воркеры TaskManager** - обработка задач
2. **ThreadPoolExecutor** - асинхронные операции
3. **Браузеры для скриншотов** - создание скриншотов веб-страниц

## Настройки в config.py

### Основные настройки потоков

```python
# Настройки потоков
max_workers: int = 10  # Количество воркеров для обработки задач
max_browsers: int = 3   # Количество браузеров для скриншотов
```

### Рекомендации по настройке

#### Для мощных серверов (8+ ядер, 16+ GB RAM)
```python
max_workers: int = 20      # Больше воркеров для параллельной обработки
max_browsers: int = 5      # Больше браузеров для быстрых скриншотов
```

#### Для средних серверов (4-8 ядер, 8-16 GB RAM)
```python
max_workers: int = 10      # Стандартное количество
max_browsers: int = 3      # Стандартное количество
```

#### Для слабых серверов (2-4 ядра, 4-8 GB RAM)
```python
max_workers: int = 5       # Меньше воркеров для экономии ресурсов
max_browsers: int = 2      # Меньше браузеров
```

#### Для очень слабых серверов (1-2 ядра, 2-4 GB RAM)
```python
max_workers: int = 3       # Минимальное количество
max_browsers: int = 1      # Один браузер
```

## Влияние настроек на производительность

### max_workers
- **Больше воркеров** = быстрее обработка задач, но больше потребление CPU
- **Меньше воркеров** = экономия ресурсов, но медленнее обработка

### max_browsers
- **Больше браузеров** = быстрее создание скриншотов, но больше потребление RAM
- **Меньше браузеров** = экономия памяти, но медленнее скриншоты

## Мониторинг ресурсов

Система автоматически мониторит использование ресурсов:

```python
# Ограничения ресурсов
max_cpu_percent: int = 90      # Максимальная загрузка CPU
max_memory_mb: int = 2048      # Максимальное использование RAM
max_network_mbps: float = 100.0 # Максимальный сетевой трафик
```

## Изменение настроек

### 1. Редактирование config.py
```python
# Настройки потоков
max_workers: int = 15  # Изменить количество воркеров
max_browsers: int = 4  # Изменить количество браузеров
```

### 2. Перезапуск сервера
```bash
# Остановить сервер
pkill -f "python -m src.task_web"

# Запустить с новыми настройками
python -m src.task_web
```

## Проверка текущих настроек

### Через API
```bash
curl -s "http://localhost:5000/api/config" | python -m json.tool
```

### Через логи
```bash
grep "воркер" logs/task_manager.log
grep "браузер" logs/scanner.log
```

## Оптимизация для конкретных задач

### Быстрое сканирование больших сетей
```python
max_workers: int = 20      # Больше параллельных сканирований
max_browsers: int = 2      # Меньше браузеров (скриншоты не критичны)
```

### Качественные скриншоты
```python
max_workers: int = 5       # Меньше воркеров
max_browsers: int = 8      # Больше браузеров для параллельных скриншотов
```

### Экономия ресурсов
```python
max_workers: int = 3       # Минимум воркеров
max_browsers: int = 1      # Один браузер
```

## Troubleshooting

### Высокое потребление CPU
- Уменьшите `max_workers`
- Уменьшите `max_browsers`
- Проверьте `max_cpu_percent`

### Высокое потребление RAM
- Уменьшите `max_browsers`
- Уменьшите `max_memory_mb`
- Проверьте логи на утечки памяти

### Медленная работа
- Увеличьте `max_workers` (если есть ресурсы)
- Увеличьте `max_browsers` (если нужны скриншоты)
- Проверьте сетевые ограничения
